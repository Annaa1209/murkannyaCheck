<script>
const counterEl = document.getElementById('counter');
const resetBtn  = document.getElementById('resetBtn');
const manualDateInput = document.getElementById('manualDate');
const setDateBtn = document.getElementById('setDateBtn');

let startTime = null;

async function fetchStart() {
  try {
    const res = await fetch('start.json?cache=' + Date.now());
    if (!res.ok) throw new Error("start.json not found");
    const data = await res.json();
    startTime = new Date(data.startTime);
  } catch (err) {
    console.error(err);
    startTime = new Date(); // fallback to current date
  }
}
function updateCounter() {
  if (!startTime) return;
  const diffMs = Date.now() - startTime.getTime();
  const totalSeconds = Math.floor(diffMs / 1000);
  const days = Math.floor(totalSeconds / 86400);
  const hours = Math.floor((totalSeconds % 86400) / 3600);
  const seconds = totalSeconds % 60;
  counterEl.textContent = `${days} дн ${hours} год ${seconds} сек`;
}
async function sendUpdate(newDate) {
  // call your small backend that triggers the GitHub Action
  await fetch('https://your-backend.example/update-start', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ startTime: newDate.toISOString() })
  });
  await fetchStart();
}

resetBtn.addEventListener('click', () => sendUpdate(new Date()));
setDateBtn.addEventListener('click', () => {
  const val = manualDateInput.value;
  if (!val) return alert('Оберіть дату та час');
  const chosenDate = new Date(val);
  if (isNaN(chosenDate.getTime())) return alert('Невірний формат дати');
  sendUpdate(chosenDate);
});

setInterval(updateCounter, 1000);
setInterval(fetchStart, 30000); // refresh from server every 30 s
fetchStart();
</script>
